DROP DATABASE IF EXISTS bdempleados;
CREATE DATABASE bdempleados;
USE bdempleados;


-- -----------------------------------------------------
-- Table departamentos
-- -----------------------------------------------------
DROP TABLE IF EXISTS departamentos;

CREATE TABLE IF NOT EXISTS departamentos (
  DEP_NO SMALLINT UNSIGNED NOT NULL, 
  DNOMBRE VARCHAR(65) NOT NULL,
  LOCALIDAD VARCHAR(65),
  PRIMARY KEY (DEP_NO)
  );

INSERT INTO departamentos VALUES 
(10,'CONTABILIDAD','BARCELONA'),
(20,'INVESTIGACION','VALENCIA'),
(30,'VENTAS','MADRID'),
(40,'PRODUCCION','SEVILLA')
;


-- -----------------------------------------------------
-- Table empleados
-- -----------------------------------------------------
DROP TABLE IF EXISTS empleados;

CREATE TABLE IF NOT EXISTS empleados (
  EMP_NO SMALLINT UNSIGNED NOT NULL,
  DNI VARCHAR(9) NOT NULL,
  NOMBRE VARCHAR(65) NOT NULL,
  APELLIDO1 VARCHAR(65) NOT NULL,
  APELLIDO2 VARCHAR(65),
  OFICIO VARCHAR(65),
  JEFE SMALLINT UNSIGNED,
  FECHA_ALTA DATE,
  SALARIO DECIMAL(8,2) UNSIGNED,
  COMISION DECIMAL(8,2) UNSIGNED,
  DEP_NO SMALLINT UNSIGNED,
  TELEFONO VARCHAR(15),
  FOTO VARCHAR(255),
  PRIMARY KEY (EMP_NO),
  UNIQUE UQ_EMP_DNI (DNI),
  UNIQUE UQ_EMP_FOTO (FOTO),
  CONSTRAINT FK_EMP_DEP_NO
    FOREIGN KEY (DEP_NO)
    REFERENCES departamentos (DEP_NO)
    ON UPDATE CASCADE,
  CONSTRAINT FK_EMP_JEFE
    FOREIGN KEY (JEFE)
    REFERENCES empleados (EMP_NO)
    ON DELETE SET NULL
    ON UPDATE CASCADE
	);

INSERT INTO empleados VALUES 
(7839,'27449907M','Ana Patricia ','Rey','Primo','PRESIDENTE',NULL,'1981-11-17',600000,NULL,10,'981587147','./empleados/7839.jpg'),
(7698,'23229790C','Luis Manuel','Garrido','Díaz','DIRECTOR',7839,'1981-05-01',385000,NULL,30,'981246798','./empleados/7698.jpg'),
(7782,'22473780C','Juan Rodrigo Fernando','Rey','Manso','DIRECTOR',7839,'1981-06-09',245000,NULL,10,'981246798',NULL),
(7499,'34784976Y','María','Alonso','Gómez','VENDEDOR',7698,'1981-02-20',140000,40000,30,'',NULL),
(7521,'74340069K','Rosa María','López','Mas','EMPLEADO',7782,'1981-05-08',135000,0,10,'696547982','./empleados/7521.jpg'),
(7654,'27464555W','Ana','Martín','Calvo','VENDEDOR',7698,'1981-09-28',150000,160000,30,'983214589','./empleados/7654.jpg'),
(7844,'22941746M','Miguel','Calvo','Torrado','VENDEDOR',7698,'1981-09-08',180000,80000,30,'766514578','./empleados/7844.jpg'),
(7876,'50933568E','Jonathan','Gil',NULL,'ANALISTA',7782,'1982-05-06',335000,NULL,20,'981125147','./empleados/7876.jpg'),
(7900,'22461004D','Ana','Jiménez','Llul','EMPLEADO',7782,'1983-03-24',140000,NULL,20,NULL,NULL),
(8898,'22479862F','Rodrigo','Cortés','Cortés','VENDEDOR',7698,'1999-02-20',180000,NULL,30,'654879255',NULL),
(8902,'22453732M','Patricia','Garrido','Rey','VENDEDOR',7782,'2007-02-06',100000,0,NULL,'','./empleados/8902.jpg'),
(8904,'27460578G','Juan Manuel','Rey','Rey','',NULL,NULL,NULL,200000,NULL,NULL,'./empleados/8904.jpg')
;



-- -----------------------------------------------------
-- Table clientes
-- -----------------------------------------------------
DROP TABLE IF EXISTS clientes;

CREATE TABLE IF NOT EXISTS clientes (
  CLIENTE_NO SMALLINT UNSIGNED NOT NULL,
  NIF VARCHAR(9) NOT NULL,
  NOMBRE VARCHAR(65) NOT NULL,
  LOCALIDAD VARCHAR(40) NOT NULL,
  VENDEDOR_NO SMALLINT UNSIGNED,
  DEBE DECIMAL(10,2) UNSIGNED,
  HABER DECIMAL(10,2) UNSIGNED,
  LIMITE_CREDITO DECIMAL(10,2) UNSIGNED,
  PRIMARY KEY (CLIENTE_NO),
  UNIQUE UQ_CLI_NIF (NIF),
  CONSTRAINT FK_CLI_EMP_NO
    FOREIGN KEY (VENDEDOR_NO)
    REFERENCES empleados (EMP_NO)
    ON DELETE SET NULL
    ON UPDATE CASCADE, 
  CHECK (DEBE <= LIMITE_CREDITO)
	);

INSERT INTO clientes VALUES 
(101,'22427339Q','DISTRIBUCIONES GOMEZ','MADRID',7499,300000,0,500000),
(102,'27438931T','LOGITRONICA S.L','BARCELONA',7654,0,120000,500000),
(103,'27465913A','INDUSTRIAS LACTEAS S.A.','LAS ROZAS',7844,0,NULL,1000000),
(104,'22918037D','TALLERES ESTESO S.A.','SEVILLA',7654,800000,0,1000000),
(105,'22478873F','EDICIONES SANZ','BARCELONA',7499,NULL,NULL,500000),
(106,'27447854E','SIGNOLOGIC S.A.','MADRID',7654,125,0,NULL),
(107,'27440525F','MARTIN Y ASOCIADOS S.L.','ARAVACA',7844,700000,0,1000000),
(108,'22456294Z','MANUFACTURAS ALI S.A.','SEVILLA',7654,0,1400,500000)
;



-- -----------------------------------------------------
-- Table productos
-- -----------------------------------------------------
DROP TABLE IF EXISTS productos;

CREATE TABLE IF NOT EXISTS productos (
  PRODUCTO_NO SMALLINT UNSIGNED NOT NULL,
  DESCRIPCION VARCHAR(250) NOT NULL,
  PRECIO_ACTUAL DECIMAL(8,2) UNSIGNED,
  STOCK_DISPONIBLE FLOAT UNSIGNED,
  FOTO VARCHAR(255),
  PRIMARY KEY (PRODUCTO_NO)
  );

INSERT INTO productos VALUES 
(10,'MESA DESPACHO MOD. GAVIOTA',55000,50,'./productos/10.jpg'),
(20,'SILLA DIRECTOR MOD. BUFALO',67000,25,'./productos/20.jpg'),
(30,'ARMARIO NOGAL DOS PUERTAS',46000,20,NULL),
(40,'MESA MODELO UNIÓN',34000,15,NULL),
(50,'ARCHIVADOR CEREZO',105000,20,'./productos/50.jpg'),
(60,'CAJA SEGURIDAD MOD B222',28000,15,NULL),
(70,'DESTRUCTORA DE PAPEL A3',45000,25,'./productos/70.jpg'),
(80,'MODULO ORDENADOR MOD. ERGOS',55000,25,NULL)
;



-- -----------------------------------------------------
-- Table pedidos
-- -----------------------------------------------------
DROP TABLE IF EXISTS pedidos;

CREATE TABLE IF NOT EXISTS pedidos (
  PEDIDO_NO SMALLINT UNSIGNED NOT NULL,
  PRODUCTO_NO SMALLINT UNSIGNED,
  CLIENTE_NO SMALLINT UNSIGNED,
  UNIDADES FLOAT UNSIGNED,
  FECHA_PEDIDO DATETIME,
  YA_PAGADO BOOLEAN,
  MODO_DE_PAGO ENUM('CONTADO','TRANSFERENCIA','CHEQUE','TARJETA','PAGO ELECTRÓNICO'),
  PRIMARY KEY (PEDIDO_NO),
  CONSTRAINT FK_PEDIDOS_CLIENTE_NO
    FOREIGN KEY (CLIENTE_NO)
    REFERENCES clientes (CLIENTE_NO)
    ON DELETE RESTRICT
    ON UPDATE CASCADE,
  CONSTRAINT FK_PEDIDOS_PRODUCTO_NO
    FOREIGN KEY (PRODUCTO_NO)
    REFERENCES productos (PRODUCTO_NO)
    ON DELETE RESTRICT
    ON UPDATE CASCADE
	);

INSERT INTO pedidos VALUES 
(1000,20,103,3,'1999-10-06 21:20:45',TRUE,'CONTADO'),
(1001,50,106,2,'1999-10-06 11:20:23',TRUE,'CONTADO'),
(1002,10,101,4,'1999-10-07 20:11:22',TRUE,'CONTADO'),
(1003,20,105,4,'1999-10-16 17:13:11',TRUE,'PAGO ELECTRÓNICO'),
(1004,40,106,8,'1999-10-20 18:33:26',TRUE,'PAGO ELECTRÓNICO'),
(1005,30,105,2,'1999-10-20 13:22:14',FALSE,'CONTADO'),
(1006,70,103,3,'1999-11-03 13:07:14',FALSE,'CONTADO'),
(1007,50,101,2,'1999-11-06 11:42:12',FALSE,NULL),
(1008,10,106,6,'1999-11-16 17:22:38',NULL,'CONTADO'),
(1009,20,105,2,'1999-11-26 20:05:00',NULL,'CONTADO'),
(1010,40,102,3,'1999-12-08 16:54:10',NULL,NULL),
(1011,30,106,2,'1999-12-15 15:11:12',TRUE,'TRANSFERENCIA'),
(1012,10,105,3,'1999-12-06 22:43:32',TRUE,'TRANSFERENCIA'),
(1013,30,106,2,'1999-12-06 11:20:22',TRUE,'TRANSFERENCIA'),
(1014,20,101,4,'2000-01-07 09:05:20',TRUE,'CHEQUE'),
(1015,70,105,4,'2000-01-16 12:22:34',TRUE,'CHEQUE'),
(1016,30,106,7,'2000-01-18 00:00:00',TRUE,'TARJETA'),
(1017,20,105,6,'2000-01-20 00:00:00',TRUE,'TARJETA'),
(1022,10,103,1,'2012-11-22 10:45:00',TRUE,NULL)
;



